<ngx-base-list [messageError]="messageError" [routes]="routes">
  <div content>

    <nb-tabset fullWidth (changeTab)="reloadForm($event)">
      <nb-tab tabTitle="A tramitar">

        <form [formGroup]="form" (ngSubmit)="FilterAuth()">
          <div class="row">
            <div class="col-md-4">
              <label for="company" class="form-text text-muted font-weight-bold">Autorizaciones por EPS:</label>
              <nb-select formControlName="company_id" id="company_id" fullWidth
                placeholder="TODOS LOS REGISTROS...">
                <nb-option>TODOS LOS REGISTROS...</nb-option>
                <nb-option *ngFor="let item of company" [value]="item.id">
                  {{ item.name }}</nb-option>
              </nb-select>
            </div>
            <div class="col-md-4">
              <label for="company" class="form-text text-muted font-weight-bold">Contratos de EPS:</label>
              <nb-select formControlName="contract_id" id="contract_id" fullWidth
                placeholder="TODOS LOS REGISTROS...">
                <nb-option>TODOS LOS REGISTROS...</nb-option>
                <nb-option *ngFor="let item of contract" [value]="item.id">
                  {{ item.name }}</nb-option>
              </nb-select>
            </div>
            <div class="col-md-4">
              <label for="briefcase_id" class="form-text text-muted font-weight-bold">Portafolios de atención:</label>
              <nb-select formControlName="briefcase_id" id="briefcase_id" fullWidth
                status="{{ isSubmitted && form.controls.briefcase_id.errors ? 'danger' : isSubmitted ? 'success' : 'basic' }}">
                <nb-option value="">Seleccione...</nb-option>
                <nb-option *ngFor="let item of briefcase"
                  [value]="item.id">
                  {{ item.name }}</nb-option>
              </nb-select>
            </div>
            <div class="col-md-4">
              <label for="admissions_id" class="form-text text-muted font-weight-bold">Admisiónes del paciente:</label>
              <nb-select [selected]="this.data.admissions_id" formControlName="admissions_id" id="admissions_id" fullWidth
                status="{{ isSubmitted && form.controls.admissions_id.errors ? 'danger' : isSubmitted ? 'success' : 'basic' }}">
                <nb-option value="">Seleccione...</nb-option>
                <nb-option selected="{{ item.id == data.admissions_id }}" *ngFor="let item of admissions" [value]="item.id">
                  {{ item.consecutive}} - {{item.location[0].scope_of_attention.name}} - {{item.location[0].program.name }}
                </nb-option>
              </nb-select>
            </div>
            <div class="col-md-4" >
              <label for="start_date" class="form-text text-muted font-weight-bold">Desde</label>
              <input class="inputdate" [max]="today" type="date" nbInput fieldSize="medium" fullWidth id="start_date" formControlName="start_date" start_date
              />
            </div>
            <div class="col-md-4">
              <label for="finish_date" class="form-text text-muted font-weight-bold">Hasta</label>
              <input class="inputdate" [min]="min_day" type="date" nbInput fieldSize="medium" fullWidth id="finish_date" formControlName="finish_date" finish_date
              />
            </div>

            <!-- <div class="col-md-6">
              <label for="admissions_id" class="form-text text-muted font-weight-bold">Admisiones:</label>
              <input fullWidth nbInput list="codes" (change)="saveCode($event.target.value)" id="admissions_id"
                formControlName="admissions_id" admissions_id type="text" required
                >
              <datalist id="codes">
                <option *ngFor="let item of admissions" [value]="item.name">{{ item.code }} - {{item.name}} </option>
              </datalist>
            </div>-->
          </div>

          <div class="col-md-12 filter">
            <button nbButton status="success" class="ml-1" disabled="{{ loading }}">Filtar</button>
          </div>

        </form>

        <ngx-base-table *ngIf="auth_status && company" (propagar)="onUserRowSelect($event)" [title]="title"
          [subtitle]="subtitle" [settings]="settings" entity="authorization/byStatus/0" customData="authorization"
          [messageToltip]="messageToltip">

          <div actions>

            <div class="actions">
              <nb-select (selectedChange)="FilterStatus($event)" placeholder="Filtrar por estado">
                <nb-option value="0">TODOS LOS REGISTROS</nb-option>
                <nb-option *ngFor="let item of auth_statusM" [value]="item.id">{{item.name}}</nb-option>
              </nb-select>
              <button nbButton status="danger" style="margin-left: 5px;" (click)="packagingProcess()">Asignar paquete</button>
            </div>

            <div class="actions">
            </div>

          </div>

        </ngx-base-table>

        <button nbButton status="success" class="btn-studen-admissions" (click)="authMassive()"> Generar
          masivo de autorizaciones
        </button>

      </nb-tab>
      <nb-tab tabTitle="Historico">

        <div *ngIf="this.showdiv">
          <ngx-historic-authorization (messageEvent)="null"></ngx-historic-authorization>
        </div>

      </nb-tab>
    </nb-tabset>

  </div>
</ngx-base-list>

<ng-template #packagingTemplate>
  <div class="container-fluid">
    <nb-card style="width: 700px;">
      <nb-card-header>Generar XLS</nb-card-header>
      <nb-card-body>
        <form [formGroup]="xlsForm" (ngSubmit)="saveCartera()">
          <div>
            <div class="col-md-12">
              <nb-select formControlName="state_gloss" id="state_gloss" fullWidth>
                <nb-option value="">Seleccione...</nb-option>
                <nb-option *ngFor="let item of company">{{item.name}}</nb-option>
              </nb-select>
            </div>
          </div>
          <div class="div-send">
            <button type="submit" nbButton status="success">Generar</button>
          </div>
        </form>
      </nb-card-body>
    </nb-card>
  </div>
</ng-template>

<ng-template #packagingedit >
  <div class="container-fluid">
    <nb-card style="max-width: 1400px;max-height: 1200px;overflow: auto;">
      <nb-card-header>Editar paquete</nb-card-header>
      <nb-card-body>
        <form [formGroup]="xlsForm" (ngSubmit)="save()">
          <div >
            <div class="col-md-12" >
              <ngx-auth-asociated-package (messageEvent)="receiveMessage($event)" [show]="false" [parentData]="this.parentData"></ngx-auth-asociated-package>
            </div>
          </div>
          <div class="div-send">
            <button type="submit" nbButton status="success">Guardar</button>
          </div>
        </form>
      </nb-card-body>
    </nb-card>
  </div>
</ng-template>